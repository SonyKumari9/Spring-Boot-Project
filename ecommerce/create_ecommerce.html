<!DOCTYPE html>
<html ng-app="myApp">
<head>
  <meta charset="UTF-8" />
  <title>Create User</title>

  <!-- AngularJS + Bootstrap -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/createecommerce.css">
</head>

<body ng-controller="myCtrl" class="bg-light">
  <form id="userForm" class="container mt-5 p-4 bg-white rounded shadow" enctype="multipart/form-data">
    <div class="form-footer" style="margin-left: 141px;">
        <small>You have already account? <a href="vender_login.html" style="color: green; font-weight: bold;">Login</a></small>
      </div>
    <h3 class="text-center mb-4">Vender Registration</h3>

    <!-- Profile Image Preview at Top -->
    <div class="text-center mb-4" ng-if="previewSrc">
      <img ng-src="{{previewSrc}}" id="preview" class="rounded-circle border shadow-sm" width="120" height="120">
    </div>

    <!-- Profile Pic Input -->
    <div class="mb-3">
      <input type="file" class="form-control" id="userPic" accept="image/*" onchange="previewProfile(event)">
    </div>

    <!-- Form Fields -->
    <input type="text" class="form-control mb-2" id="userName" placeholder="userName" required>
    <input type="email" class="form-control mb-2" id="userEmail" placeholder="userEmail" required>
    <input type="text" class="form-control mb-2" id="userAddress" placeholder="Address">
    <input type="password" class="form-control mb-2" id="userPassword" placeholder="Password">
    <input type="text" class="form-control mb-3" id="userPhone" placeholder="Phone">

    <button type="submit" class="btn btn-primary w-100">Submit</button>
  </form>

  <script>
  function previewProfile(event) {
    const reader = new FileReader();
    reader.onload = function () {
      const scope = angular.element(document.getElementById('userForm')).scope();
      scope.$apply(() => scope.previewSrc = reader.result);
    };
    reader.readAsDataURL(event.target.files[0]);
  }

  document.getElementById('userForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    // Validate email
    const userEmail = document.getElementById('userEmail').value;
    const userPhone = document.getElementById('userPhone').value;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const phoneRegex = /^[0-9]{10}$/;

    if (!emailRegex.test(userEmail)) {
      alert("Invalid email format!");
      return;
    }

    if (!phoneRegex.test(userPhone)) {
      alert("Phone number must be 10 digits.");
      return;
    }

    // Prepare form data (image: any type, any size)
    const formData = new FormData();
    formData.append("userName", document.getElementById('userName').value);
    formData.append("userEmail", userEmail);
    formData.append("userAddress", document.getElementById('userAddress').value);
    formData.append("userPassword", document.getElementById('userPassword').value);
    formData.append("userPhone", userPhone);

    const fileInput = document.getElementById('userPic');
    if (fileInput.files.length > 0) {
      formData.append("userPic", fileInput.files[0]);
    }

    try {
      const response = await fetch('http://localhost:8086/createu/v2/user', {
        method: 'POST',
        body: formData
      });

      const result = await response.json();
      console.log('Success:', result);
      alert("User created successfully!");
      window.location.href="vender_login.html";
    } catch (error) {
      console.error('Error:', error);
      alert("Failed to create user.");
    }
  });

  angular.module('myApp', [])
    .controller('myCtrl', function ($scope) {
      $scope.previewSrc = null;
    });
</script>

</body>
</html>
