<!DOCTYPE html>
<html lang="en" ng-app="settingsApp">
<head>
  <meta charset="UTF-8" />
  <title>eShop Settings</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

  <style>
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }
    body.dark-mode .setting-card {
      background-color: #1e1e1e;
      border-color: #444;
    }
    .setting-card {
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      transition: transform 0.2s;
      background-color: #fff;
    }
    .setting-card:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .setting-icon {
      font-size: 1.8rem;
      color: #007bff;
    }
    .setting-title {
      font-weight: 600;
      font-size: 1.1rem;
    }
    .exit-link {
      color: #dc3545;
      float: right;
      cursor: pointer;
      margin-top: 10px;
    }
    .exit-link:hover {
      text-decoration: underline;
    }
    .profile-img {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #007bff;
      margin-bottom: 10px;
    }
    .form-check-input {
      cursor: pointer;
    }
  </style>
</head>
<body ng-controller="SettingsController" ng-class="{'dark-mode': isDarkMode}">

  <div class="container mt-5">
    <div class="exit-link" onclick="window.location.href='mainpage_eshopping.html'">
      <i class="fas fa-sign-out-alt"></i> Exit
    </div>

    <!-- Profile Section -->
    <div class="text-center mb-4">
      <img ng-src="{{profileImage}}" alt="Profile Image" class="profile-img" />
      <h4>{{username}}</h4>
      <p class="text-muted">{{email}}</p>
    </div>

    <!-- Toggles -->
    <div class="row justify-content-center mb-4">
      <div class="col-md-3">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="darkModeToggle" ng-model="isDarkMode">
          <label class="form-check-label" for="darkModeToggle">üåô Dark Mode</label>
        </div>
      </div>
      <div class="col-md-3">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="notifToggle" ng-model="notificationsEnabled">
          <label class="form-check-label" for="notifToggle">üîî Notifications</label>
        </div>
      </div>
      <div class="col-md-3">
        <select class="form-select" ng-model="language">
          <option value="en">üåê English</option>
          <option value="hi">üáÆüá≥ Hindi</option>
          <option value="es">üá™üá∏ Spanish</option>
          <option value="fr">üá´üá∑ French</option>
        </select>
      </div>
    </div>

    <!-- Setting Options -->
    <div class="row">
      <div class="col-md-4 mb-4" ng-repeat="option in settingsOptions">
        <div class="setting-card text-center">
          <i class="{{ option.icon }} setting-icon mb-2"></i>
          <div class="setting-title">{{ option.title }}</div>
          <p class="text-muted">{{ option.desc }}</p>
          <button class="btn btn-sm btn-outline-primary mt-2" ng-click="navigate(option.link)">
            Go to {{ option.title }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    angular.module('settingsApp', [])
      .controller('SettingsController', function ($scope, $http) {
        // Load saved email
        $scope.email = localStorage.getItem("savedUserEmail") || "sony@example.com";

        // Fetch user info from backend
        $http.get(`http://localhost:8086/ecommerce/v1/user/${$scope.email}`)
          .then(function (response) {
            const user = response.data;
            $scope.username = user.name || "Profile";
            $scope.profileImage = user.imageUrl?.startsWith("http")
              ? user.imageUrl
              : "http://localhost:8086" + user.imageUrl;
          })
          .catch(function (error) {
            console.error("User fetch failed:", error);
            $scope.username = "Unknown";
            $scope.profileImage = "http://localhost:8086/profile_image/default.jpg";
          });

        // UI settings
        $scope.isDarkMode = false;
        $scope.notificationsEnabled = true;
        $scope.language = "en";

        // Setting Tiles
        $scope.settingsOptions = [
          {
            title: "My Profile",
            desc: "View & edit your personal details.",
            icon: "fas fa-user-circle",
            link: "profilepage.html"
          },
          {
            title: "Wishlist",
            desc: "See all your favorite items.",
            icon: "fas fa-heart",
            link: "cardpage.html"
          },
          {
            title: "Orders",
            desc: "Track, return or cancel orders.",
            icon: "fas fa-box-open",
            link: "orderpage.html"
          },
          {
            title: "Cart",
            desc: "View products in your cart.",
            icon: "fas fa-shopping-cart",
            link: "cardpage_payment.html"
          },
          {
            title: "Delivery Address",
            desc: "Manage your shipping addresses.",
            icon: "fas fa-map-marker-alt",
            link: "addresspage.html"
          },
          {
            title: "Payment Methods",
            desc: "Add or update payment options.",
            icon: "fas fa-credit-card",
            link: "paymentpage.html"
          },
          {
            title: "Security",
            desc: "Change password or 2FA.",
            icon: "fas fa-shield-alt",
            link: "securitypage.html"
          },
          {
            title: "Mail eShop",
            desc: "Send messages or queries.",
            icon: "fas fa-envelope",
            link: "mailpage.html"
          },
          {
            title: "Contact Support",
            desc: "Chat or email our support team.",
            icon: "fas fa-headset",
            link: "supportpage.html"
          },
          {
            title: "Logout",
            desc: "Sign out from your account.",
            icon: "fas fa-sign-out-alt",
            link: "logout.html"
          }
        ];

        $scope.navigate = function (link) {
          window.location.href = link;
        };
      });
  </script>
</body>
</html>
