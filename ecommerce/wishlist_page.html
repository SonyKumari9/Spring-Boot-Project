<!DOCTYPE html>
<html ng-app="wishlistApp">
<head>
  <meta charset="UTF-8">
  <title>Meesho Style Wishlist</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <style>
    .thumbnail-img {
      width: 180px;
      height: 180px;
      object-fit: cover;
      border-radius: 0.5rem;
    }
    .img-wrapper {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 0.5rem;
      transition: box-shadow 0.3s;
    }
    .img-wrapper:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .heart-icon {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #999;
      transition: color 0.3s ease;
    }
    .heart-icon.red {
      color: red;
    }
    .pagination-btn {
      margin: 0 5px;
    }
  </style>
</head>
<body class="p-4" ng-controller="WishlistController">

  <nav class="navbar navbar-expand-lg navbar-light bg-light px-4 mb-4">
    <a class="navbar-brand fw-bold text-primary" href="#">eShop</a>
    <form class="d-flex mx-auto" style="width: 50%;" ng-submit="search()">
      <input class="form-control me-2" type="search" placeholder="Search for products" ng-model="searchText">
    </form>
    <a href="mainpage_eshopping.html" class="btn btn-outline-success">Back App</a>
  </nav>

  <div class="container">
    <div class="row mb-3">
      <div class="col-md-3">
        <select class="form-select" ng-model="selectedCategory">
          <option value="">All Categories</option>
          <option ng-repeat="category in uniqueCategories">{{ category }}</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" ng-model="selectedSize">
          <option value="">All Sizes</option>
          <option ng-repeat="size in sizes">{{ size }}</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" ng-model="selectedPriceRange">
          <option value="">All Prices</option>
          <option value="199-2000">₹199–₹2000</option>
          <option value="2001+">₹2000+</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" ng-model="sortOrder">
          <option value="">Sort by</option>
          <option value="price">Price: Low to High</option>
          <option value="-price">Price: High to Low</option>
        </select>
      </div>
    </div>

    <h4>Product Gallery</h4>
    <div class="row">
      <div class="col-md-3" ng-repeat="product in paginatedProducts()">
        <div class="img-wrapper">
          <img ng-src="{{product.imageUrl}}" class="thumbnail-img">
          <div class="heart-icon" ng-class="{'red': product.wishlisted}" ng-click="toggleWishlist(product)">♥</div>
          <div><strong>{{product.brand}}</strong></div>
          <div>₹{{product.price}} | Size: {{product.size}}</div>
          <button class="btn btn-sm btn-primary mt-2" ng-click="addToCart(product)">Add to Cart</button> 
           <!-- <button class="btn btn-sm btn-primary mt-2"><a href="cardpage.html">Add to Cart</a></button> -->
        </div>
      </div>
    </div>

    <!-- Pagination Controls -->
    <div class="text-center my-3">
      <button class="btn btn-outline-secondary pagination-btn" ng-disabled="currentPage === 0" ng-click="currentPage = currentPage - 1">Prev</button>
      <span class="mx-2">Page {{currentPage + 1}} / {{pageCount()}}</span>
      <button class="btn btn-outline-secondary pagination-btn" ng-disabled="currentPage >= pageCount() - 1" ng-click="currentPage = currentPage + 1">Next</button>
    </div>

    <h4 class="mt-4">Your Wishlist</h4>
    <div class="row">
      <div class="col-md-3" ng-repeat="item in paginatedWishlist()">
        <div class="img-wrapper bg-light">
          <img ng-src="{{item.imageUrl}}" class="thumbnail-img">
          <div><strong>{{item.brand}}</strong></div>
          <div>₹{{item.price}}</div>
        </div>
      </div>
    </div>

    <!-- Wishlist Pagination -->
    <div class="text-center mt-3">
      <button class="btn btn-outline-secondary pagination-btn" ng-disabled="wishlistPage === 0" ng-click="wishlistPage = wishlistPage - 1">Prev</button>
      <span class="mx-2">Page {{wishlistPage + 1}} / {{wishlistPageCount()}}</span>
      <button class="btn btn-outline-secondary pagination-btn" ng-disabled="wishlistPage >= wishlistPageCount() - 1" ng-click="wishlistPage = wishlistPage + 1">Next</button>
    </div>
  </div>

<script>
angular.module('wishlistApp', [])
.controller('WishlistController', function ($scope, $http) {
  $scope.products = [];
  $scope.searchText = "";
  $scope.selectedCategory = "";
  $scope.selectedSize = "";
  $scope.selectedPriceRange = "";
  $scope.sortOrder = "";
  $scope.currentPage = 0;
  $scope.itemsPerPage = 4;
  $scope.wishlistPage = 0;
  $scope.sizes = ['S', 'M', 'L', 'XL'];

  $scope.loadProducts = function () {
    $http.get('http://localhost:8086/wishlist/v7/all').then(function (response) {
      $scope.products = response.data.map(function (item) {
        item.wishlisted = false;
        item.size = $scope.sizes[Math.floor(Math.random() * $scope.sizes.length)];
        return item;
      });

      $scope.uniqueCategories = [...new Set($scope.products.map(p => p.categoryTitle))];
    });
  };

  $scope.filterProducts = function (product) {
    if ($scope.selectedCategory && product.categoryTitle !== $scope.selectedCategory) return false;
    if ($scope.selectedSize && product.size !== $scope.selectedSize) return false;
    if ($scope.selectedPriceRange === "199-2000" && (product.price < 199 || product.price > 2000)) return false;
    if ($scope.selectedPriceRange === "2001+" && product.price <= 2000) return false;
    return true;
  };

  $scope.paginatedProducts = function () {
    let filtered = $scope.products
      .filter($scope.filterProducts)
      .filter(p => !$scope.searchText || p.brand.toLowerCase().includes($scope.searchText.toLowerCase()))
      .sort((a, b) => {
        if ($scope.sortOrder === "price") return a.price - b.price;
        if ($scope.sortOrder === "-price") return b.price - a.price;
        return 0;
      });
    let start = $scope.currentPage * $scope.itemsPerPage;
    return filtered.slice(start, start + $scope.itemsPerPage);
  };

  $scope.pageCount = function () {
    let count = $scope.products.filter($scope.filterProducts).length;
    return Math.ceil(count / $scope.itemsPerPage);
  };

  $scope.paginatedWishlist = function () {
    let wished = $scope.products.filter(p => p.wishlisted);
    let start = $scope.wishlistPage * $scope.itemsPerPage;
    return wished.slice(start, start + $scope.itemsPerPage);
  };

  $scope.wishlistPageCount = function () {
    let count = $scope.products.filter(p => p.wishlisted).length;
    return Math.ceil(count / $scope.itemsPerPage);
  };

  $scope.toggleWishlist = function (item) {
    item.wishlisted = !item.wishlisted;
    if (item.wishlisted) {
      $http.post('http://localhost:8086/wishlist/v7/add', item);
    } else {
      $http.delete('http://localhost:8086/wishlist/v7/delete/' + item.categoryId);
    }
  };

  $scope.addToCart = function (item) {
    alert("Added " + item.brand + " to cart!");
  };

  $scope.loadProducts();
});
</script>
</body>
</html>
